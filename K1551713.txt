_MYDATA SEGMENT
	STR1	DB	0AH, 0DH, '---------------------$'
	STR2	DB	0AH, 0DH, '  SIMPLE CALCULATOR  $'
	STR3	DB	0AH, 0DH, '  BY ZHANG ZHEN YAN  $'
	STR4	DB	0AH, 0DH, 'S=$'
	MAINANS		DW	9 DUP(0)
	ANSCOUNT	EQU	$ - MAINANS
	REMAIN		DB	2 DUP(0)
	REMAINCOUNT	EQU	$ - REMAIN
	FIN			DW	0
	FLAG		DB	0
_MYDATA	ENDS

; NAME: SHOW
; INSTRUCTION: Print a string using function 9.
; REG OCCUPATION: AX, DX.
; INPUT: Already initialized string.
; OUTPUT: None.

SHOW MACRO STR
	PUSH	AX
	PUSH	DX
	LEA		DX, STR
	MOV		AH, 9
	INT		21H
	POP		DX
	POP		AX
ENDM

; NAME: CRLF
; INSTRUCTION: Start a new line.
; REG OCCUPATION: AX, DX.
; INPUT: None.
; OUTPUT: None.

CRLF MACRO
	PUSH	AX
	PUSH	DX
	MOV		AH, 2
	MOV		DL, 0DH
	INT		21H
	MOV		AH, 2
	MOV		DL, 0AH
	INT		21H
	POP		DX
	POP		AX
ENDM

_CODE SEGMENT
	ASSUME	CS: _CODE, DS: _MYDATA
_MAIN PROC	FAR
	PUSH	DS
	MOV		AX, 0
	PUSH	AX
	MOV		AX, _MYDATA
	MOV		DS, AX
	; Main program starts here.
	
	; Initialization starts here.
	SHOW	STR1
	CRLF
	SHOW	STR2
	SHOW	STR3
	CRLF
	SHOW	STR1
	MOV		AX, 0
	MOV		BX, 0
	MOV		CX, 0
	MOV		DX, 0
	CRLF
	SHOW	STR4
	; Initialization ends here.
	
_INPUT:
	MOV	AX, 0100H
	INT	21H

_COMPARE:
	CMP		AL, 0DH
	JE		_FINAL		; Input CR.
	CMP		AL, 2BH
	JE		_PLUS		; Input '+'.
	CMP		AL, 2DH
	JE		_MINUS		; Input '-'.
	CMP		AL, 2AH
	JE		_MTPLY		; Input '*'.
	CMP		AL, 2FH
	JE		_DVIDE		; Input '/'.
	CMP		AL, 30H
	JB		_INPUT		; Illegal inputs < 30H.
	CMP		AL, 39H
	JBE		_DIGITS		; Input 30H ~ 39H.
	JMP		_INPUT		; Illegal inputs > 39H.

_DIGITS:
	CMP		FLAG, 0
	JNE		_INPUT
	AND		AL, 0FH		; Change ascii to number.
	PUSH	AX
	INC		FLAG
	JMP		_INPUT

_PLUS:
	CMP		FLAG, 0
	JE		_INPUT
	POP		AX
	CALL	__PLUS
	JMP		_INPUT

_MINUS:
	CMP		FLAG, 0
	JE		_INPUT
	POP		AX
	CALL	__MINUS
	JMP		_INPUT

_MTPLY:
	CMP		FLAG, 0
	JE		_INPUT
	POP		AX
	CALL	__MTPLY
	JMP		_INPUT

_DVIDE:
	CMP		FLAG, 0
	JE		_INPUT
	POP		AX
	CALL	__DVIDE
	JMP		_INPUT

	; Main program ends here.
	RET
_MAIN	ENDP

; NAME: _PLUS
; INSTRUCTION: .
; REG OCCUPATION:
; INPUT:
; OUTPUT:

_PRINTH PROC	NEAR
	
_PRINTH	ENDP

_CODE ENDS
	END	_MAIN